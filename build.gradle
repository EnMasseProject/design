plugins {
    id "de.undercouch.download" version "3.1.1"
}

allprojects  {
    group = 'enmasse'
}

import de.undercouch.gradle.tasks.download.Download

task downloadArtemis(type: Download) {
    src 'http://people.redhat.com/~ulilleen/apache-artemis-2.0.0-SNAPSHOT-bin.tar.gz'
    dest new File(buildDir, 'apache-artemis-bin.tar.gz')
}

task buildArtemis {
  doLast {
    exec {
      workingDir 'activemq-artemis/integration/activemq-amqp-connector'
      commandLine 'mvn', 'install'
    }
  }
}

task buildZip(type: Zip) {
    from('activemq-artemis/integration/activemq-amqp-connector/target') {
        into('connector')
    }
    from('config_templates') {
        into('config')
    }
    from('utils') {
        into('utils')
    }
    from('artemis-launcher/build/exe/main/main') {
        into('launcher')
    }
    from('artemis-shutdown-hook/build/distributions/artemis-shutdown-hook.tar') {
        into('shutdown-hook')
    }
    archiveName 'artemis-image.zip'
    destinationDir file('build')
}
