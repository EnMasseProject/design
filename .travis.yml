sudo: required
language: java
jdk:
- oraclejdk8
services:
- docker
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
after_success:
- export REPO=enmasseproject/storage-controller
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH
  ; fi`
- docker build -t $REPO:$COMMIT storage-controller-server
- if [ "$TRAVIS_BRANCH" == "master" ] && [ "$TRAVIS_PULL_REQUEST" == "false" ]; then
  docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS; docker tag $REPO:$COMMIT
  $REPO:$TAG; docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER; docker push
  $REPO; TRAVIS_TOKEN=$ACCESS_TOKEN sh .trigger-travis.sh; fi
env:
  global:
  - COMMIT=${TRAVIS_COMMIT::8}
  - secure: Aqs45aXQT6zfsUH3hsSL8DHy56Ly9MfPaH/2ezGzRuBsfxzYuaAUqy8BvWUzExdNscL5yX8sqgcdk1aqzheOTt7VDxm4axrZwB+mQl1jdEqPyEnKGWV/HgFnz/GPbMEmLOiNliurbwwz2GNW6r955o+KWyzVotfKP5JvF2alpX5rLEX4okf+lVQGuapW0p4Ctt+REVitDesD/EGmHLf6dELXoeW05VDLruxK2X5y0NcSsD+Dz34ivKUdv223gYDMWdAh0m3/RZ4xCfsgmtY9ypS9Yzc5oFCyj40QVYtPDFSSuOXaAyNLC1FPXD1PLdA46Up0XRUc8A0eV9K2dku0+0+yFTZse+iUVrGd8ogwRkx9DDrEC9Z8NVY00HGiLemeLbv5zPCKsgYXZUotBSa0awL5P0XvO/uwO24v/VfLDCMR1sWdq2OkEbre3cd29RDnEwUbqx/fqyte8Znqhg5bLxW8cbKXuzorGyS7EZf7O8NzHkCn56vwYPW1MEKjrx5yk6ZgWtXYx7OIhOJD7649E8q8s8g/KEa+Rt10EwkV4spmTV6RppqKVcuO54Pj2dWGaQQLRp6fGI2an8uyZJalqJvtGufnu9Qw3uAGRXO+Yx12GGCDuFZn88Cy5x+KiMUUq4ATbEO1h3oosFX5XP7ASFckdrItLlU9tx6xPtGyeyY=
  - secure: mnxxt83SbxN9TyEdxBQ9q+lwaBe3MlijJZZrfLOHjXSdaGU8yHk1tXkC+LOL7qHqrDixJEOSom4ZbJAcH9IrgIihxqlVF+1duYJ54fnATMsefNgEO0uj3LgXFbo2XLzP7L9U9B12QDQw1gHhqSV8qoq5G/OncmOi0dD2ac1KrgL3Ecme0wOzFe1xmRbrVRRKHRvy7Hy8Vagj2VFNhYRANhtUlpIIcuSarDlwth0eD91p7PSZCcn8NVtaFG3S5Kk6h54Km0dRe9kuDr6s26qXvSHEaX7d2HUUGSsnL53jVxBkNFH1q3huOh+IjrHhJ6I3Kk+xC+h5TBh7HKTYnHCZGrtAxL0QLfc1nMQs4gvjsLjcPtfa3rEhyUEF/EZSFgPp5zVhnbQIKsb7/hVvRUzfCUb2FCqEstBFMADGV6koDAGAgrb0bMHP3NA1iRr6kIIpyZMjU/iL5RQbp1lMe2tHrJspDciGi98+JKJQsttap/6W1N1Ujyxgvpu0CEo6bRcZ6HyU/cYgTZCrdOOnB8PXDyiTwb69CWShCFa+muswMH3zFQ3jaGf4lty5L6vzVy6aJ+icFhPPTH7IXbTixoBj8oyWSfyQQj4RwPn2VZC1N+u112/g0/auqsnk5GQargo/6tAmaMCxmMsUy4RUGQxEt99LjbJ6MC8apT99xlhSg18=
  - secure: AW0b6xY9G1ApsURsa5o8fvsXpD+MfQs6ZHbgHBfUSugGP1bB9NlSVMQRiOhs0aBVUk0qABsge0oLpCsBgsmvMGg7UNFw7Gfg7S05w6Yn57L51sxmh8pIsOqrcu9+X+7RN9kagoGfX/kDk+t5DVBTy5Ki9kkGWkcBZhg4gWuiLBGgjYi4PRoeeNnGG6sxjBrsORYa9uCVJbpsQPyYHvl/0HcZ4Z0y3mWPr/SO9g+HAAx7un7B7x+y7QoX36WuI2KVvyOOBlTfUAS/p7A1B0NIaVrj9ichYYLa1e2k6XLRr4EzdVAFnfRAeO8i7Un5Pm5+PbbjATwAdNEEdx2OplR51ULdyVcoOZ7Nra73Yf9nXWiPc4rZo2EN0iNI6SCLqIpSWmbhj97O0CZuobLsUPZZFoHjF5M7YY58SY3pLxHDDWhGtgXZ16KvEng4n9z74W+jqvM0SyKXyiXAMcFl00zUqGBl570a/KA903YD5j7VqzE31Gfb8ImmLWu7rAMn//eSukcz57dEE0ltI2Nejy5G3a7/eXAmSYcHPObYjGp7wseR0vq3r0kYig5/1Xw0hXFSJQ6vKcHNSTFa3GhALCTKYHuaRvr2dXsh1H/w0AELoItAIsbawNbOeJ6MhUV02TtCI46wtdobs2ufAqA75LtqMptxx7rfZPIc+K8IMT4TBec=
  - secure: dWQgkPd4r5PwlhpI7QBDhU0M+OUvz/fLiH4vYh0WTV1GIAAoc4TpjaUOJPhXwKoYDce6Mgx2BVyK7MaIvnIFZgPo4OSSB3rJ6oYskYQ1Ji2KeWnjsHYMSCwVheLl4vgiV1lOcWKbQX0DRRMQtjp6IAVtEorAIC4AqNThsrbXn4bTi79TvQQvlK4+0UxnfDZl/ibbt7z22O4UNhs5c7NiJXyy6JJby7cydtwIBEj16TrTFPbAi2hv//PG2mbLgmE0na4+G5bU2SAG67j/dzSCN1cQw+5Oz/+xRc1M2dB3h59GwEQjrUCUn9w1MWG9S4zMocUVirLaMFEOVCWQ8JgCdsNtxJBiIL23xJqyTxRkiyP25EWqifw4so8NqHVeZx+aXlL/skMlBvpkiDq++Ft+2bkdWrn0UtTU61HSa/QCEY8egaSVmno90LOkpST3z58iJ1g4Mpx2KVbQZMPdLtWL3sYUSS24pP83FPoOlHuFQnXillz3hRgFrDqRTaMm91MDwLTRtQqQ+mkLocAot5qURuC93pNU70LBfP7FDEAgyjx4QGHjZZe97WZevoooZvxXY2oAHnJlzXuoatKQoGH0+JxsGTKI8q2B3GylCBPYP7KBJNMWbaoGwbOesvLwENlNzbT1AoNhoh6nkn0Gco2iGfv1T/D4LqHRda6zHu81Ano=
